<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTA | Admin '<%= user.id %>' Profile</title>

    <link rel="shortcut icon" href="/static/images/thumb.png">
        
    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/fonts.css">
    <link rel="stylesheet" href="/static/css/brix-family.css">

    <link rel="stylesheet" href="/static/css/colors.css">
        
    <link rel="stylesheet" href="/admin/admProfile.css">
</head>
<body>

    <!-- each location has own color for Chart -->
    <% const colorArray = ['black', 'red', 'orange', 'yellow', 'green', 'cyan', 'blue', 'purple'] %>

    <div class="main-adm-box">
        <% if (user) { %>

            <div class="left-panel">
                <div class="navigation">
                    <a class="-btn -main-page" href="/">
                        <i class="fas fa-warehouse"></i>
                        Main Page
                    </a>
                    <div class="adm-profile">
                        <p><%= user.email.toLowerCase() %></p>
                        <p>Auth:<span class="adm-prop"><%= user.authString.toUpperCase() %></span></p>
                        <p>Location:<span class="adm-prop"><%= user.location.toUpperCase() %></span></p>
                    </div>  <!-- adm-profile -->
                    <form class="log-out-form" action="/admin/logout" method="POST">
                        <button class="-btn -log-out" type="submit">Sign Out</button>
                    </form>
                </div>

                <div class="navigation">
                    <a class="-btn" href="/admin/user-area">
                        <i class="fas fa-users"></i>
                        Users Area
                    </a>
                    <a class="-btn" href="/admin/student/list">
                        <i class="fas fa-address-book"></i>
                        Student List
                    </a>
                    <a class="-btn" href="/admin/student">
                        <i class="fas fa-feather"></i>
                        INs
                    </a>
                    <a class="-btn" href="/catalog">
                        <i class="fas fa-book"></i>
                        Catalog
                    </a>
                </div>  <!-- navigation -->
            </div>  <!-- left-panel -->

            <div class="adm-desktop">
                <div class="top-side">
                    
                    <section class="tool-bar">
                        <div class="charts-bar">
                            <a class="chart-item" href="/admin/charts/AR">
                                <svg class="chart-ico" viewBox="0 0 512 512">
                                    <path d="M32 32C49.67 32 64 46.33 64 64V400C64 408.8 71.16 416 80 416H480C497.7 416 512 430.3 512 448C512 465.7 497.7 480 480 480H80C35.82 480 0 444.2 0 400V64C0 46.33 14.33 32 32 32zM160 224C177.7 224 192 238.3 192 256V320C192 337.7 177.7 352 160 352C142.3 352 128 337.7 128 320V256C128 238.3 142.3 224 160 224zM288 320C288 337.7 273.7 352 256 352C238.3 352 224 337.7 224 320V160C224 142.3 238.3 128 256 128C273.7 128 288 142.3 288 160V320zM352 192C369.7 192 384 206.3 384 224V320C384 337.7 369.7 352 352 352C334.3 352 320 337.7 320 320V224C320 206.3 334.3 192 352 192zM480 320C480 337.7 465.7 352 448 352C430.3 352 416 337.7 416 320V96C416 78.33 430.3 64 448 64C465.7 64 480 78.33 480 96V320z"/>
                                </svg>
                                <span>Accounts Receivable</span>
                            </a>
                            <!-- <svg class="chart-ico" viewBox="0 0 576 512">
                                <path d="M304 16.58C304 7.555 310.1 0 320 0C443.7 0 544 100.3 544 224C544 233 536.4 240 527.4 240H304V16.58zM32 272C32 150.7 122.1 50.34 238.1 34.25C248.2 32.99 256 40.36 256 49.61V288L412.5 444.5C419.2 451.2 418.7 462.2 411 467.7C371.8 495.6 323.8 512 272 512C139.5 512 32 404.6 32 272zM558.4 288C567.6 288 575 295.8 573.8 305C566.1 360.9 539.1 410.6 499.9 447.3C493.9 452.1 484.5 452.5 478.7 446.7L320 288H558.4z"/>
                            </svg> -->
                        </div>
                        <div class="top-side-name"><%= user.name %></div>
                    </section>

                    <div class="top-side-id"><%= user.id %></div>
                </div>  <!-- top-side -->
                <% if(analyticsArray) { %>
                    <div class="chart-title">New Students Enrollment Chart</div>
                    <div class="analythicsChart">
                        <% analyticsArray.map(item => { %>
                            <div class="chart-column" data-key="<%= item.month %>.<%= item.year %>" data-value="<%= item.newStudents %>">
                                <% if(item.newStudents > 0) { %>
                                    <% item.locations.map((location, index) => { %>
                                        <% if(item.locationValues[index] > 0) { %>
                                            <% let perc = item.locationValues[index] *100 / item.newStudents %>
                                            <% let href = `/admin/student/shortlist?year=${item.year}&month=${item.month}&location=${location}` %>
                                            <% let title = `${location} - ${item.locationValues[index]}` %>
                                            <a href='<%= href %>' class="chart-sub-column" data-value="<%= item.locationValues[index] %>" style="--h:<%= perc %>%; --c:<%= colorArray[index - 1] %>" title="<%= title %>"></a>  <!-- use index-1 because 0th el. is 'All' -->
                                        <% } %>
                                    <% }) %>
                                <% } %>
                            </div>
                        <% }) %>
                    </div>  <!-- analythicsChart -->
                <% } %>
            </div>  <!-- desktop -->

        <% } %>     <!-- admin is defined -->
    </div>  <!-- main-adm-box -->



    <script>

        // @drawing chart
        // get chart div height depending on vh
        const chart = document.querySelector(".analythicsChart")

        if (chart) {
            const maxHeight = parseFloat(getComputedStyle(chart).height)
            const cols = document.querySelectorAll(".chart-column")
            
            // cols[1].dataset.value = '10'
            // cols[2].dataset.value = '12'
            // cols[4].dataset.value = '5'

            if (maxHeight && cols) {
                // find max value
                let max = 0
                for (let i=0; i<cols.length; i++) {
                    if (parseInt(cols[i].dataset.value) > max) { max = parseInt(cols[i].dataset.value) }
                }
                if (max) {
                    // setting values espectively to max                    
                    for (let i=0; i<cols.length; i++) {
                        cols[i].style.height = `${ parseInt(cols[i].dataset.value) * maxHeight / max }px`
                    }
                }
            }
        }

    </script>

</body>
</html>