<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTA | Admin '<%= user.id %>' Profile</title>

    <link rel="shortcut icon" href="/static/images/thumb.png">
        
    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/fonts.css">
    <link rel="stylesheet" href="/static/css/brix-family.css">

    <link rel="stylesheet" href="/static/css/colors.css">
        
    <link rel="stylesheet" href="/admin/admProfile.css">
</head>
<body>

    <!-- each location has own color for Chart -->
    <% const colorArray = ['black', 'red', 'orange', 'yellow', 'green', 'cyan', 'blue', 'purple'] %>

    <div class="main-adm-box">
        <% if (user) { %>

            <div class="left-panel">
                <div class="navigation">
                    <a class="-btn -main-page" href="/">
                        <img class="fas" src="/static/images/thumb.png" alt="main toro page">
                        <span class="menu-item">Main Page</span>
                    </a>
                    <div class="adm-profile">
                        <p class="profile-email"><%= user.email.toLowerCase() %></p>
                        <p>Auth:<span class="adm-prop"><%= user.authString.toUpperCase() %></span></p>
                        <p>Location:<span class="adm-prop"><%= user.location.toUpperCase() %></span></p>
                    </div>  <!-- adm-profile -->
                    <form class="log-out-form" action="/admin/logout" method="POST">
                        <button class="-btn -log-out" type="submit">Sign Out</button>
                    </form>
                </div>

                <div class="navigation">
                    <a class="-btn" href="/admin/user-area">
                        <i class="fas fa-users"></i>
                        <span class="menu-item">Users Area</span>
                    </a>
                    <a class="-btn" href="/admin/student/list">
                        <i class="fas fa-address-book"></i>
                        <span class="menu-item">Student List</span>
                    </a>
                    <a class="-btn" href="/admin/student">
                        <i class="fas fa-feather"></i>
                        <span class="menu-item">INs</span>
                    </a>
                    <a class="-btn" href="/admin/student/expulsion">
                        <svg viewBox="0 0 512 512"><path d="M480 416C497.7 416 512 430.3 512 448C512 465.7 497.7 480 480 480H150.6C133.7 480 117.4 473.3 105.4 461.3L25.37 381.3C.3786 356.3 .3786 315.7 25.37 290.7L258.7 57.37C283.7 32.38 324.3 32.38 349.3 57.37L486.6 194.7C511.6 219.7 511.6 260.3 486.6 285.3L355.9 416H480zM265.4 416L332.7 348.7L195.3 211.3L70.63 336L150.6 416L265.4 416z"/></svg>
                        <span class="menu-item">Expulsion</span>
                    </a>
                    <a class="-btn" href="/admin/schedule">
                        <svg viewBox="0 0 448 512"><path d="M160 32V64H288V32C288 14.33 302.3 0 320 0C337.7 0 352 14.33 352 32V64H400C426.5 64 448 85.49 448 112V160H0V112C0 85.49 21.49 64 48 64H96V32C96 14.33 110.3 0 128 0C145.7 0 160 14.33 160 32zM0 192H448V464C448 490.5 426.5 512 400 512H48C21.49 512 0 490.5 0 464V192zM80 256C71.16 256 64 263.2 64 272V336C64 344.8 71.16 352 80 352H368C376.8 352 384 344.8 384 336V272C384 263.2 376.8 256 368 256H80z"/></svg>
                        <span class="menu-item">Schedule</span>
                    </a>
                    <a class="-btn" href="/admin/student/skills-test">
                        <svg viewBox="0 0 576 512"><path d="M248.8 4.994C249.9 1.99 252.8 .0001 256 .0001C259.2 .0001 262.1 1.99 263.2 4.994L277.3 42.67L315 56.79C318 57.92 320 60.79 320 64C320 67.21 318 70.08 315 71.21L277.3 85.33L263.2 123C262.1 126 259.2 128 256 128C252.8 128 249.9 126 248.8 123L234.7 85.33L196.1 71.21C193.1 70.08 192 67.21 192 64C192 60.79 193.1 57.92 196.1 56.79L234.7 42.67L248.8 4.994zM427.4 14.06C446.2-4.686 476.6-4.686 495.3 14.06L529.9 48.64C548.6 67.38 548.6 97.78 529.9 116.5L148.5 497.9C129.8 516.6 99.38 516.6 80.64 497.9L46.06 463.3C27.31 444.6 27.31 414.2 46.06 395.4L427.4 14.06zM461.4 59.31L356.3 164.3L379.6 187.6L484.6 82.58L461.4 59.31zM7.491 117.2L64 96L85.19 39.49C86.88 34.98 91.19 32 96 32C100.8 32 105.1 34.98 106.8 39.49L128 96L184.5 117.2C189 118.9 192 123.2 192 128C192 132.8 189 137.1 184.5 138.8L128 160L106.8 216.5C105.1 221 100.8 224 96 224C91.19 224 86.88 221 85.19 216.5L64 160L7.491 138.8C2.985 137.1 0 132.8 0 128C0 123.2 2.985 118.9 7.491 117.2zM359.5 373.2L416 352L437.2 295.5C438.9 290.1 443.2 288 448 288C452.8 288 457.1 290.1 458.8 295.5L480 352L536.5 373.2C541 374.9 544 379.2 544 384C544 388.8 541 393.1 536.5 394.8L480 416L458.8 472.5C457.1 477 452.8 480 448 480C443.2 480 438.9 477 437.2 472.5L416 416L359.5 394.8C354.1 393.1 352 388.8 352 384C352 379.2 354.1 374.9 359.5 373.2z"/></svg>
                        <span class="menu-item">Skills Test</span>
                    </a>
                    <a class="-btn" href="/admin/student/wbdrs">
                        <svg viewBox="0 0 512 512"><path d="M0 219.2v212.5c0 14.25 11.62 26.25 26.5 27C75.32 461.2 180.2 471.3 240 511.9V245.2C181.4 205.5 79.99 194.8 29.84 192C13.59 191.1 0 203.6 0 219.2zM482.2 192c-50.09 2.848-151.3 13.47-209.1 53.09C272.1 245.2 272 245.3 272 245.5v266.5c60.04-40.39 164.7-50.76 213.5-53.28C500.4 457.9 512 445.9 512 431.7V219.2C512 203.6 498.4 191.1 482.2 192zM352 96c0-53-43-96-96-96S160 43 160 96s43 96 96 96S352 149 352 96z"/></svg>
                        <span class="menu-item">WBDRS</span>
                    </a>
                    <a class="-btn" href="/catalog">
                        <i class="fas fa-book"></i>
                        <span class="menu-item">Catalog</span>
                    </a>
                </div>  <!-- navigation -->
            </div>  <!-- left-panel -->

            <div class="adm-desktop">
                <div class="top-side">
                    
                    <section class="tool-bar">
                        <div class="charts-bar">
                            <a class="chart-item" href="/admin/charts/AR">
                                <svg class="chart-ico" viewBox="0 0 512 512">
                                    <path d="M32 32C49.67 32 64 46.33 64 64V400C64 408.8 71.16 416 80 416H480C497.7 416 512 430.3 512 448C512 465.7 497.7 480 480 480H80C35.82 480 0 444.2 0 400V64C0 46.33 14.33 32 32 32zM160 224C177.7 224 192 238.3 192 256V320C192 337.7 177.7 352 160 352C142.3 352 128 337.7 128 320V256C128 238.3 142.3 224 160 224zM288 320C288 337.7 273.7 352 256 352C238.3 352 224 337.7 224 320V160C224 142.3 238.3 128 256 128C273.7 128 288 142.3 288 160V320zM352 192C369.7 192 384 206.3 384 224V320C384 337.7 369.7 352 352 352C334.3 352 320 337.7 320 320V224C320 206.3 334.3 192 352 192zM480 320C480 337.7 465.7 352 448 352C430.3 352 416 337.7 416 320V96C416 78.33 430.3 64 448 64C465.7 64 480 78.33 480 96V320z"/>
                                </svg>
                                <span>Accounts Receivable</span>
                            </a>
                            <a class="chart-item" href="/admin/charts/PF">
                                <svg class="chart-ico" viewBox="0 0 512 512">
                                    <path d="M64 400C64 408.8 71.16 416 80 416H480C497.7 416 512 430.3 512 448C512 465.7 497.7 480 480 480H80C35.82 480 0 444.2 0 400V64C0 46.33 14.33 32 32 32C49.67 32 64 46.33 64 64V400zM342.6 278.6C330.1 291.1 309.9 291.1 297.4 278.6L240 221.3L150.6 310.6C138.1 323.1 117.9 323.1 105.4 310.6C92.88 298.1 92.88 277.9 105.4 265.4L217.4 153.4C229.9 140.9 250.1 140.9 262.6 153.4L320 210.7L425.4 105.4C437.9 92.88 458.1 92.88 470.6 105.4C483.1 117.9 483.1 138.1 470.6 150.6L342.6 278.6z"/>
                                </svg>
                                <span>Enrollment Dynamics</span>
                            </a>
                            <a class="chart-item" href="/admin/charts/IA">
                                <svg class="chart-ico" viewBox="0 0 576 512">
                                    <path d="M304 16.58C304 7.555 310.1 0 320 0C443.7 0 544 100.3 544 224C544 233 536.4 240 527.4 240H304V16.58zM32 272C32 150.7 122.1 50.34 238.1 34.25C248.2 32.99 256 40.36 256 49.61V288L412.5 444.5C419.2 451.2 418.7 462.2 411 467.7C371.8 495.6 323.8 512 272 512C139.5 512 32 404.6 32 272zM558.4 288C567.6 288 575 295.8 573.8 305C566.1 360.9 539.1 410.6 499.9 447.3C493.9 452.1 484.5 452.5 478.7 446.7L320 288H558.4z"/>
                                </svg>
                                <span>Instructors Activity</span>
                            </a>
                        </div>
                        <div class="top-side-name"><%= user.name %></div>
                    </section>

                    <div class="top-side-id"><%= user.id %></div>
                </div>  <!-- top-side -->
                <% if(analyticsArray) { %>
                    <div class="chart-title">New Students Enrollment Chart</div>
                    <div class="analythicsChart">
                        <% analyticsArray.map(item => { %>
                            <div class="chart-column" data-key="<%= item.month %>.<%= item.year %>" data-value="<%= item.newStudents %>">
                                <% if(item.newStudents > 0) { %>
                                    <% item.locations.map((location, index) => { %>
                                        <% if(item.locationValues[index] > 0) { %>
                                            <% let perc = item.locationValues[index] *100 / item.newStudents %>
                                            <% let href = `/admin/student/shortlist?year=${item.year}&month=${item.month}&location=${location}` %>
                                            <% let title = `${location} - ${item.locationValues[index]}` %>
                                            <a href='<%= href %>' class="chart-sub-column" data-value="<%= item.locationValues[index] %>" style="--h:<%= perc %>%; --c:<%= colorArray[index - 1] %>" title="<%= title %>"></a>  <!-- use index-1 because 0th el. is 'All' -->
                                        <% } %>
                                    <% }) %>
                                <% } %>
                            </div>
                        <% }) %>
                    </div>  <!-- analythicsChart -->
                <% } %>
            </div>  <!-- desktop -->
        <% } %>     <!-- admin is defined -->
    </div>  <!-- main-adm-box -->



    <script defer>

        // @drawing chart
        // get chart div height depending on vh
        const chart = document.querySelector(".analythicsChart")

        if (chart) {
            const maxHeight = parseFloat(getComputedStyle(chart).height)
            const cols = document.querySelectorAll(".chart-column")
            if (maxHeight && cols) {
                // find max value
                let max = 0
                for (let i=0; i<cols.length; i++) {
                    if (parseInt(cols[i].dataset.value) > max) { max = parseInt(cols[i].dataset.value) }
                }
                if (max) {
                    // setting values espectively to max                    
                    for (let i=0; i<cols.length; i++) {
                        cols[i].style.height = `${ parseInt(cols[i].dataset.value) * maxHeight / max }px`
                    }
                }
            }
        }

    </script>

</body>
</html>